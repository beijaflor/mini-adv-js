<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>mini-adv-js</title>
<link rel="stylesheet" href="css/mini-adv.css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.js"></script>
<script>

var scenario = [
  {    // SCENE 0
    "src": "img/scene02.png",
    "text": "this is scene 2",
    "next": [1, 2]
  }, { // SCENE 1
    "src": "img/scene03.png",
    "text": "this is scene 3",
    "next": 3
  }, { // SCENE 2
    "src": "img/scene04.png",
    "text": "this is scene 4",
    "next": 0
  }, { // SCENE 3
    "src": "img/scene05.png",
    "text": "this is scene 5",
    "next": 256
  }
];

jQuery(function($) {
  // set variables
  var $SCENE = $("#scene");
  var $MESSAGE = $("#message");
  var $BUTTON_AREA = $("#sec-scene");

  var DEF_SCENE = $SCENE.attr("src");
  var DEF_TEXT = "default text";

  var BOX_STYLE1 = {
    "position": "absolute",
    "top": "10px",
    "left": "10px",
    "border": "solid 1px #999",
    "width": "100px",
    "height": "100px"
  };

  var BOX_STYLE2 = {
    "position": "absolute",
    "top": "10px",
    "left": "10px",
    "border": "solid 1px #899",
    "width": "100px",
    "height": "100px"
  };

  var BOX_STYLE3 = {
    "position": "absolute",
    "top": "10px",
    "left": "150px",
    "border": "solid 1px #989",
    "width": "100px",
    "height": "100px"
  };

  var URL_TO_FINISH = "http://www.goo.ne.jp/";

  var sceneNum = 0;

  // error check
  if($SCENE.length < 1) {
    throw('no <img id="scene">');
  }
  if($MESSAGE.length < 1) {
    throw('no <p id="message">');
  }

  // init
  setNext(0);

  // functions
  function setNext(next) {
    $SCENE.add($MESSAGE).off("click");
    $BUTTON_AREA.find("div").remove();
    if($.isArray(next)) {
      var option1 = $("<div>").attr("id", "button1").css(BOX_STYLE2);
      var option2 = $("<div>").attr("id", "button2").css(BOX_STYLE3);

      option1.on("click", function() {
        setNext(nextScene(scenario, next[0]));
      });
      option2.on("click", function() {
        setNext(nextScene(scenario, next[1]));
      });
      $("#sec-scene").append(option1, option2);
    } else {
      var option = $("<div>").attr("id", "button1").css(BOX_STYLE1);
      option.on("click", function() {
        setNext(nextScene(scenario, next));
      });
      $("#sec-scene").append(option);
    }
  }
  function nextScene(arr, num) {
    var sceneData;
    if(arr.length <= num) {
      location.href = URL_TO_FINISH;
    } else {
      sceneData = arr[num];
      changeSet(sceneData);
      return sceneData["next"];
    }
  }
  function changeSet(hash) {
    var src, text;
    hash = (hash) ? hash : {} ;
    src = (hash.src) ? hash.src : DEF_SCENE ;
    text = (hash.text) ? hash.text : DEF_TEXT ;
    console.log("src:" + src);
    console.log("text:" + text);

    changeScene(src);
    changeMessage(text);
  }

  function changeScene(src) {
    $SCENE.attr("src", src);
  }

  function changeMessage(text) {
    $MESSAGE.text(text);
  }
});

</script>
</head>
<body>

<h1>mini-adv-js</h1>

<section id="sec-scene">
<img src="img/scene01.png" id="scene">
</section>

<section id="sec-message">
<p id="message"></p>
</section>

</body>
</html>
